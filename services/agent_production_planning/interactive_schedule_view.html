<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Scheduler</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap5.min.css">
    <style>
        body { 
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; 
            background-color: #f5f7fa;
            color: #333;
        }
        .container-fluid {
            max-width: 1400px;
            margin: 0 auto;
        }
        .dashboard {
            margin-bottom: 30px; 
            padding: 20px; 
            border-radius: 8px; 
            background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #eaeaea;
        }
        .dashboard h3 {
            margin-top: 0;
            font-weight: 600;
            color: #3a3a3a;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        table.dataTable {
            border-collapse: separate !important;
            border-spacing: 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .status-critical { background-color: rgba(255, 0, 0, 0.15); }
        .status-warning { background-color: rgba(255, 190, 0, 0.15); }
        .status-caution { background-color: rgba(128, 0, 128, 0.15); }
        .status-ok { background-color: rgba(0, 128, 0, 0.15); }
        
        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: 600;
            text-align: center;
            width: 100%;
        }
        .badge-critical { background-color: #ffcccc; color: #cc0000; border: 1px solid #ff8080; }
        .badge-warning { background-color: #fff2cc; color: #b38600; border: 1px solid #ffdb4d; }
        .badge-caution { background-color: #f0d6f0; color: #800080; border: 1px solid #d699d6; }
        .badge-ok { background-color: #d6f0d6; color: #006600; border: 1px solid #99d699; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="mb-0"><i class="bi bi-calendar-check me-2"></i>Production Scheduler</h1>
            <div>
                <button class="btn btn-primary" onclick="window.print()">
                    <i class="bi bi-printer me-1"></i> Print
                </button>
                <button class="btn btn-outline-secondary ms-2" onclick="exportTableToCSV('production_schedule.csv')">
                    <i class="bi bi-download me-1"></i> Export
                </button>
            </div>
        </div>
        
        <div class="dashboard row">
            <div class="col-md-6">
                <h3>Schedule Overview</h3>
                <p><strong>Total Jobs:</strong> 35</p>
                <p><strong>Date Range:</strong> 2025-03-15 08:00 to 2025-04-17 03:30</p>
                <p><strong>Total Duration:</strong> 231.90000000000003 hours</p>
            </div>
            <div class="col-md-6">
                <h3>Buffer Status</h3>
                <div class="d-flex flex-column gap-2">
                    <div class="d-flex align-items-center">
                        <div class="status-badge badge-critical me-2" style="width: 120px;">Critical</div>
                        <div class="progress flex-grow-1" style="height: 20px;">
                            <div class="progress-bar bg-danger" role="progressbar" 
                                style="width: 5.714285714285714%;" 
                                aria-valuenow="2" 
                                aria-valuemin="0" aria-valuemax="35">
                                2 jobs
                            </div>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="status-badge badge-warning me-2" style="width: 120px;">Warning</div>
                        <div class="progress flex-grow-1" style="height: 20px;">
                            <div class="progress-bar bg-warning text-dark" role="progressbar" 
                                style="width: 11.428571428571429%;" 
                                aria-valuenow="4" 
                                aria-valuemin="0" aria-valuemax="35">
                                4 jobs
                            </div>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="status-badge badge-caution me-2" style="width: 120px;">Caution</div>
                        <div class="progress flex-grow-1" style="height: 20px;">
                            <div class="progress-bar" role="progressbar" style="background-color: purple; width: 0.0%;" 
                                aria-valuenow="0" 
                                aria-valuemin="0" aria-valuemax="35">
                                0 jobs
                            </div>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="status-badge badge-ok me-2" style="width: 120px;">OK</div>
                        <div class="progress flex-grow-1" style="height: 20px;">
                            <div class="progress-bar bg-success" role="progressbar" 
                                style="width: 82.85714285714286%;" 
                                aria-valuenow="29" 
                                aria-valuemin="0" aria-valuemax="35">
                                29 jobs
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="table-container">
            <h2>Production Jobs</h2>
            <table id="scheduleTable" class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>LCD_DATE</th>
                        <th>START_DATE</th>
                        <th>PROCESS_CODE</th>
                        <th>JOB_CODE</th>
                        <th>MACHINE_ID</th>
                        <th>PRIORTY</th>
                        <th>START_TIME</th>
                        <th>END_TIME</th>
                        <th>DURATION (h)</th>
                        <th>BUFFER (h)</th>
                        <th>BUFFER_STATUS</th>
                    </tr>
                </thead>
                <tbody>

                    <tr class="status-ok">
                        <td>2025-04-01 08:00</td>
                        <td>2025-03-15 08:00</td>
                        <td>CP08-145-P01-06</td>
                        <td>JOST25010030</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-15 08:00</td>
                        <td>2025-03-16 00:40</td>
                        <td>16.7</td>
                        <td>391.3</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-01 08:00</td>
                        <td></td>
                        <td>CP08-145-P02-06</td>
                        <td>JOST25010030</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-22 22:42</td>
                        <td>2025-03-23 15:22</td>
                        <td>16.7</td>
                        <td>208.6</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-01 08:00</td>
                        <td></td>
                        <td>CP08-145-P03-06</td>
                        <td>JOST25010030</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-23 15:22</td>
                        <td>2025-03-24 08:02</td>
                        <td>16.7</td>
                        <td>192.0</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-01 08:00</td>
                        <td></td>
                        <td>CP08-145-P04-06</td>
                        <td>JOST25010030</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-24 08:02</td>
                        <td>2025-03-25 00:42</td>
                        <td>16.7</td>
                        <td>175.3</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-01 08:00</td>
                        <td></td>
                        <td>CP08-145-P05-06</td>
                        <td>JOST25010030</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-25 00:42</td>
                        <td>2025-03-25 17:22</td>
                        <td>16.7</td>
                        <td>158.6</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-05 08:00</td>
                        <td></td>
                        <td>CP08-154-P01-04</td>
                        <td>JOST24120308</td>
                        <td>SM</td>
                        <td>2</td>
                        <td>2025-03-21 12:09</td>
                        <td>2025-03-21 12:18</td>
                        <td>0.1</td>
                        <td>355.7</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-05 08:00</td>
                        <td></td>
                        <td>CP08-154-P02-04</td>
                        <td>JOST24120308</td>
                        <td>ST-4</td>
                        <td>2</td>
                        <td>2025-03-21 12:18</td>
                        <td>2025-03-21 17:09</td>
                        <td>4.9</td>
                        <td>350.8</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-05 08:00</td>
                        <td></td>
                        <td>CP08-154-P03-04</td>
                        <td>JOST24120308</td>
                        <td>ST-4</td>
                        <td>2</td>
                        <td>2025-03-21 17:09</td>
                        <td>2025-03-22 02:53</td>
                        <td>9.7</td>
                        <td>341.1</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-warning">
                        <td>2025-04-17 08:00</td>
                        <td>2025-04-16 08:00</td>
                        <td>CT10-026A-A-P01-07</td>
                        <td>JOTP25010228</td>
                        <td>TP</td>
                        <td>2</td>
                        <td>2025-04-16 08:00</td>
                        <td>2025-04-16 12:30</td>
                        <td>4.5</td>
                        <td>19.5</td>
                        <td><div class="status-badge badge-warning">Warning</div></td>
                    </tr>
                    <tr class="status-warning">
                        <td>2025-04-17 08:00</td>
                        <td></td>
                        <td>CT10-026A-A-P02-07</td>
                        <td>JOTP25010228</td>
                        <td>TP</td>
                        <td>2</td>
                        <td>2025-04-16 12:30</td>
                        <td>2025-04-16 14:18</td>
                        <td>1.8</td>
                        <td>17.7</td>
                        <td><div class="status-badge badge-warning">Warning</div></td>
                    </tr>
                    <tr class="status-warning">
                        <td>2025-04-17 08:00</td>
                        <td></td>
                        <td>CT10-026A-A-P03-07</td>
                        <td>JOTP25010228</td>
                        <td>TP</td>
                        <td>2</td>
                        <td>2025-04-16 14:18</td>
                        <td>2025-04-16 17:54</td>
                        <td>3.6</td>
                        <td>14.1</td>
                        <td><div class="status-badge badge-warning">Warning</div></td>
                    </tr>
                    <tr class="status-warning">
                        <td>2025-04-17 08:00</td>
                        <td></td>
                        <td>CT10-026A-A-P04-07</td>
                        <td>JOTP25010228</td>
                        <td>TP</td>
                        <td>2</td>
                        <td>2025-04-16 17:54</td>
                        <td>2025-04-16 21:30</td>
                        <td>3.6</td>
                        <td>10.5</td>
                        <td><div class="status-badge badge-warning">Warning</div></td>
                    </tr>
                    <tr class="status-critical">
                        <td>2025-04-17 08:00</td>
                        <td></td>
                        <td>CT10-026A-A-P05-07</td>
                        <td>JOTP25010228</td>
                        <td>TP</td>
                        <td>2</td>
                        <td>2025-04-16 21:30</td>
                        <td>2025-04-17 01:06</td>
                        <td>3.6</td>
                        <td>6.9</td>
                        <td><div class="status-badge badge-critical">Critical</div></td>
                    </tr>
                    <tr class="status-critical">
                        <td>2025-04-17 08:00</td>
                        <td></td>
                        <td>CT10-026A-A-P06-07</td>
                        <td>JOTP25010228</td>
                        <td>TP</td>
                        <td>2</td>
                        <td>2025-04-17 01:06</td>
                        <td>2025-04-17 03:30</td>
                        <td>2.4</td>
                        <td>4.5</td>
                        <td><div class="status-badge badge-critical">Critical</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-18 08:00</td>
                        <td></td>
                        <td>CO02-022-P06-07</td>
                        <td>JOST24120261</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-21 17:24</td>
                        <td>2025-03-21 18:43</td>
                        <td>1.3</td>
                        <td>661.3</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-18 08:00</td>
                        <td></td>
                        <td>CO02-022-P05-07</td>
                        <td>JOST24120261</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-21 16:05</td>
                        <td>2025-03-21 17:24</td>
                        <td>1.3</td>
                        <td>662.6</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-18 08:00</td>
                        <td></td>
                        <td>CO02-022-P04-07</td>
                        <td>JOST24120261</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-21 14:47</td>
                        <td>2025-03-21 16:05</td>
                        <td>1.3</td>
                        <td>663.9</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-18 08:00</td>
                        <td></td>
                        <td>CO02-022-P02-07</td>
                        <td>JOST24120261</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-21 12:09</td>
                        <td>2025-03-21 13:28</td>
                        <td>1.3</td>
                        <td>666.5</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-18 08:00</td>
                        <td></td>
                        <td>CO02-022-P01-07</td>
                        <td>JOST24120261</td>
                        <td>SM</td>
                        <td>2</td>
                        <td>2025-03-21 11:52</td>
                        <td>2025-03-21 12:09</td>
                        <td>0.3</td>
                        <td>667.8</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-18 08:00</td>
                        <td></td>
                        <td>CO02-022-P03-07</td>
                        <td>JOST24120261</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-21 13:28</td>
                        <td>2025-03-21 14:47</td>
                        <td>1.3</td>
                        <td>665.2</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-27 08:00</td>
                        <td></td>
                        <td>CT10-005-P06-07</td>
                        <td>JOST25010288</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-26 14:12</td>
                        <td>2025-03-26 18:22</td>
                        <td>4.2</td>
                        <td>757.6</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-27 08:00</td>
                        <td></td>
                        <td>CT10-005-P01-07</td>
                        <td>JOST25010288</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-25 17:22</td>
                        <td>2025-03-25 21:32</td>
                        <td>4.2</td>
                        <td>778.5</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-27 08:00</td>
                        <td></td>
                        <td>CT10-005-P02-07</td>
                        <td>JOST25010288</td>
                        <td>ST-3</td>
                        <td>1</td>
                        <td>2025-03-25 21:32</td>
                        <td>2025-03-26 01:42</td>
                        <td>4.2</td>
                        <td>774.3</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-27 08:00</td>
                        <td></td>
                        <td>CT10-005-P03-07</td>
                        <td>JOST25010288</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-26 01:42</td>
                        <td>2025-03-26 05:52</td>
                        <td>4.2</td>
                        <td>770.1</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-27 08:00</td>
                        <td></td>
                        <td>CT10-005-P04-07</td>
                        <td>JOST25010288</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-26 05:52</td>
                        <td>2025-03-26 10:02</td>
                        <td>4.2</td>
                        <td>766.0</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-27 08:00</td>
                        <td></td>
                        <td>CT10-005-P05-07</td>
                        <td>JOST25010288</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-26 10:02</td>
                        <td>2025-03-26 14:12</td>
                        <td>4.2</td>
                        <td>761.8</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-28 08:00</td>
                        <td></td>
                        <td>CP08-120-P01-04</td>
                        <td>JOST25020010</td>
                        <td>ST</td>
                        <td>2</td>
                        <td>2025-03-21 11:52</td>
                        <td>2025-03-21 12:14</td>
                        <td>0.4</td>
                        <td>907.8</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-28 08:00</td>
                        <td></td>
                        <td>CP08-120-P02-04</td>
                        <td>JOST25020010</td>
                        <td>ST</td>
                        <td>2</td>
                        <td>2025-03-21 12:14</td>
                        <td>2025-03-21 12:37</td>
                        <td>0.4</td>
                        <td>907.4</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-28 08:00</td>
                        <td></td>
                        <td>CP08-120-P03-04</td>
                        <td>JOST25020010</td>
                        <td>ST</td>
                        <td>2</td>
                        <td>2025-03-21 12:37</td>
                        <td>2025-03-21 12:59</td>
                        <td>0.4</td>
                        <td>907.0</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-29 08:00</td>
                        <td>2025-03-15 08:00</td>
                        <td>CA25-001-P01-04</td>
                        <td>JOAW25020099</td>
                        <td>AL</td>
                        <td>2</td>
                        <td>2025-03-15 08:00</td>
                        <td>2025-03-17 19:01</td>
                        <td>59.0</td>
                        <td>1021.0</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-29 08:00</td>
                        <td></td>
                        <td>CA25-001-P02-04</td>
                        <td>JOAW25020099</td>
                        <td>AL</td>
                        <td>2</td>
                        <td>2025-03-23 22:53</td>
                        <td>2025-03-24 05:58</td>
                        <td>7.1</td>
                        <td>866.0</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-29 08:00</td>
                        <td></td>
                        <td>CA25-001-P03-04</td>
                        <td>JOAW25020099</td>
                        <td>AL</td>
                        <td>2</td>
                        <td>2025-03-24 05:58</td>
                        <td>2025-03-24 09:31</td>
                        <td>3.5</td>
                        <td>862.5</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-30 08:00</td>
                        <td></td>
                        <td>CP08-031-P02-04</td>
                        <td>JOST25020167</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-21 22:29</td>
                        <td>2025-03-22 02:16</td>
                        <td>3.8</td>
                        <td>941.7</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-30 08:00</td>
                        <td></td>
                        <td>CP08-031-P01-04</td>
                        <td>JOST25020167</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-21 18:43</td>
                        <td>2025-03-21 22:29</td>
                        <td>3.8</td>
                        <td>945.5</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                    <tr class="status-ok">
                        <td>2025-04-30 08:00</td>
                        <td></td>
                        <td>CP08-031-P03-04</td>
                        <td>JOST25020167</td>
                        <td>ST-3</td>
                        <td>2</td>
                        <td>2025-03-22 02:16</td>
                        <td>2025-03-22 06:02</td>
                        <td>3.8</td>
                        <td>938.0</td>
                        <td><div class="status-badge badge-ok">OK</div></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#scheduleTable').DataTable({
                order: [[0, 'asc']], // Sort by LCD_DATE by default
                pageLength: 25,
                lengthMenu: [10, 25, 50, 100, 200],
                responsive: true,
                dom: 'Bfrtip',
                buttons: [
                    {
                        extend: 'excel',
                        text: '<i class="bi bi-file-earmark-excel me-1"></i> Excel',
                        className: 'btn btn-sm btn-success',
                        exportOptions: {
                            columns: ':visible'
                        }
                    },
                    {
                        extend: 'csv',
                        text: '<i class="bi bi-file-earmark-text me-1"></i> CSV',
                        className: 'btn btn-sm btn-info',
                        exportOptions: {
                            columns: ':visible'
                        }
                    },
                    {
                        extend: 'pdf',
                        text: '<i class="bi bi-file-earmark-pdf me-1"></i> PDF',
                        className: 'btn btn-sm btn-danger',
                        exportOptions: {
                            columns: ':visible'
                        }
                    },
                    {
                        extend: 'colvis',
                        text: '<i class="bi bi-eye me-1"></i> Columns',
                        className: 'btn btn-sm btn-secondary'
                    }
                ],
                initComplete: function () {
                    // Add a legend at the top
                    var legendHtml = '<div class="mb-3 p-3 bg-white rounded shadow-sm">' +
                        '<h5 class="border-bottom pb-2 mb-3"><i class="bi bi-info-circle me-2"></i>Buffer Status Legend:</h5>' +
                        '<div class="d-flex flex-wrap gap-3">' +
                        '<div class="status-badge badge-critical">Critical (&lt;8h)</div>' +
                        '<div class="status-badge badge-warning">Warning (&lt;24h)</div>' +
                        '<div class="status-badge badge-caution">Caution (&lt;72h)</div>' +
                        '<div class="status-badge badge-ok">OK (&gt;72h)</div>' +
                        '</div></div>';
                    $('.dataTables_wrapper').prepend(legendHtml);
                }
            });
        });
        
        function exportTableToCSV(filename) {
            var csv = [];
            var rows = document.querySelectorAll("table tr");
            
            for (var i = 0; i < rows.length; i++) {
                var row = [], cols = rows[i].querySelectorAll("td, th");
                
                for (var j = 0; j < cols.length; j++) {
                    // Get the text content, handling the case of the status badge
                    var text = cols[j].innerText;
                    if (cols[j].querySelector('.status-badge')) {
                        text = cols[j].querySelector('.status-badge').innerText;
                    }
                    row.push('"' + text.replace(/"/g, '""') + '"');
                }
                
                csv.push(row.join(","));
            }
            
            // Download CSV file
            downloadCSV(csv.join("\n"), filename);
        }
        
        function downloadCSV(csv, filename) {
            var csvFile = new Blob([csv], {type: "text/csv"});
            var downloadLink = document.createElement("a");
            
            // File name
            downloadLink.download = filename;
            
            // Create a link to the file
            downloadLink.href = window.URL.createObjectURL(csvFile);
            
            // Hide download link
            downloadLink.style.display = "none";
            
            // Add the link to DOM
            document.body.appendChild(downloadLink);
            
            // Click download link
            downloadLink.click();
            
            // Remove the link
            document.body.removeChild(downloadLink);
        }
    </script>
</body>
</html>